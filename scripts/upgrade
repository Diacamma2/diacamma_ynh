#!/bin/bash

source _common.sh
source /usr/share/yunohost/helpers

#=================================================
# STOP SUPERVISOR SERVICE
#=================================================
ynh_script_progression "Stopping a supervisor service..."

supervisorctl stop ${app}

#=================================================
# UPDATE DIACAMMA
#=================================================
ynh_script_progression "Updating Diacamma..."

update_software

refresh_collect

#=================================================
# REAPPLY SYSTEM CONFIGURATIONS
#=================================================
ynh_script_progression "Upgrading system configurations related to $app..."

ynh_config_add_nginx

ynh_config_add --template="supervisor.conf" --destination="/etc/supervisor/conf.d/${app}.conf"
supervisorctl reread

ynh_config_add_logrotate

#=================================================
# START SUPERVISOR SERVICE
#=================================================
ynh_script_progression "Starting a supervisor service..."

supervisorctl start ${app}

#=================================================
# END OF SCRIPT
#=================================================

ynh_script_progression "Upgrade of $app completed"
